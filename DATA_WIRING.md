# ğŸ”Œ DATA WIRING DIAGRAM
## Relasi Data & Alur Sistem TOKONEMBAHMO
**Last Updated:** February 17, 2026

---

## ğŸ“Š ENTITY RELATIONSHIP DIAGRAM (ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATABASE SCHEMA                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   ADMINS     â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ id (PK)      â”‚
                                  â”‚ nama         â”‚
                                  â”‚ email        â”‚
                                  â”‚ password_hashâ”‚
                                  â”‚ role         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PRODUCTS   â”‚                  â”‚  AFFILIATORS â”‚                  â”‚  CUSTOMERS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚                  â”‚ id (PK)      â”‚                  â”‚ id (PK)      â”‚
â”‚ name         â”‚                  â”‚ nama         â”‚                  â”‚ nama         â”‚
â”‚ price        â”‚                  â”‚ email        â”‚                  â”‚ nomor_wa (UK)â”‚
â”‚ description  â”‚                  â”‚ nomor_wa     â”‚                  â”‚ alamat       â”‚
â”‚ image_url    â”‚                  â”‚ password_hashâ”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ product_code â”‚                  â”‚ status       â”‚                        â”‚
â”‚ commission_  â”‚                  â”‚ current_     â”‚                        â”‚ (Lookup Only)
â”‚   rate       â”‚                  â”‚   balance    â”‚                        â–¼
â”‚ sort_order   â”‚                  â”‚ bank_name    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ berat_produk â”‚                  â”‚ account_num  â”‚              â”‚   OFFLINE ORDER      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   FORM (UI)          â”‚
       â”‚                                 â”‚                      â”‚   uses customers     â”‚
       â”‚                                 â”‚                      â”‚   for autocomplete   â”‚
       â”‚ 1:N                             â”‚ 1:N                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ORDER_ITEMS  â”‚                  â”‚CUSTOMER_     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚  BINDING     â”‚
â”‚ id (PK)      â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ order_id(FK) â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ id (PK)      â”‚
â”‚ product_id   â”‚         â”‚        â”‚ user_id (FK) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   (FK)       â”‚         â”‚        â”‚ affiliator_  â”‚        â”‚
â”‚ qty          â”‚         â”‚        â”‚   id (FK)    â”‚        â”‚
â”‚ varian       â”‚         â”‚        â”‚ start_date   â”‚        â”‚
â”‚ satuan       â”‚         â”‚        â”‚ end_date     â”‚        â”‚
â”‚ harga_satuan â”‚         â”‚        â”‚ status       â”‚        â”‚
â”‚ subtotal     â”‚         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚               â”‚                â”‚
                         â”‚               â”‚ 90 days        â”‚
                         â”‚               â–¼                â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚                  ORDERS                   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id (PK)                                  â”‚
                    â”‚ order_number (#YYYYMMDD-XXXXX)           â”‚
                    â”‚ user_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
                    â”‚ affiliator_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”
                    â”‚ status (WAITING/PROCESSING/SHIPPED/DONE) â”‚   â”‚   â”‚
                    â”‚ metode_bayar (transfer/cod)              â”‚   â”‚   â”‚
                    â”‚ total_produk                             â”‚   â”‚   â”‚
                    â”‚ shipping_cost                            â”‚   â”‚   â”‚
                    â”‚ total_bayar                              â”‚   â”‚   â”‚
                    â”‚ alamat                                   â”‚   â”‚   â”‚
                    â”‚ nomor_wa                                 â”‚   â”‚   â”‚
                    â”‚ resi                                     â”‚   â”‚   â”‚
                    â”‚ shipping_courier                         â”‚   â”‚   â”‚
                    â”‚ is_offline (true for manual orders)      â”‚   â”‚   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
                                                                   â”‚   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
                    â”‚                  USERS                    â”‚â—€â”€â”€â”˜   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
                    â”‚ id (PK)                                  â”‚       â”‚
                    â”‚ nama                                     â”‚       â”‚
                    â”‚ nomor_wa (UNIQUE)                        â”‚       â”‚
                    â”‚ email                                    â”‚       â”‚
                    â”‚ alamat                                   â”‚       â”‚
                    â”‚ binding_affiliator_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ binding_start_date                       â”‚       â”‚
                    â”‚ binding_end_date                         â”‚       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                    â”‚               WITHDRAWALS                 â”‚â—€â”€â”€â”€â”€â”€â”€â”˜
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id (PK)                                  â”‚
                    â”‚ affiliator_id (FK)                       â”‚
                    â”‚ nominal                                  â”‚
                    â”‚ status (pending/approved/paid)           â”‚
                    â”‚ bank_name                                â”‚
                    â”‚ bank_account                             â”‚
                    â”‚ bukti_transfer_url                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        AFFILIATOR_PRODUCT_LINKS          â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id (PK)                                  â”‚
                    â”‚ affiliator_id (FK)                       â”‚
                    â”‚ product_id (FK)                          â”‚
                    â”‚ tiktok_link                              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ DATA FLOW DIAGRAMS

### 1. Order Creation Flow (Online - Customer via Storefront)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚     â”‚  CartDrawer  â”‚     â”‚  Checkout    â”‚     â”‚   Backend    â”‚
â”‚   Browser    â”‚     â”‚  Component   â”‚     â”‚   Process    â”‚     â”‚   Supabase   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Browse Products   â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Add to Cart       â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Click Checkout    â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  Fill Customer     â”‚                    â”‚
       â”‚                    â”‚  Info (nama, wa,   â”‚                    â”‚
       â”‚                    â”‚  alamat)           â”‚                    â”‚
       â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ createOrGetUser()  â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                    â”‚                    â”‚     user_id        â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ If has referral:   â”‚
       â”‚                    â”‚                    â”‚ createBinding()    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ createOrder()      â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ addOrderItems()    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ sendOrderConfirm() â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Fonnte API
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Show Success      â”‚                    â”‚                    â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
```

### 2. Order Creation Flow (Offline - Admin Manual)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Admin     â”‚     â”‚ OfflineOrder â”‚     â”‚  WA Parser   â”‚     â”‚   Supabase   â”‚
â”‚  Dashboard   â”‚     â”‚    Form      â”‚     â”‚  + Address   â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Open Form         â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Paste WA Message  â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  parseWAMessage()  â”‚                    â”‚
       â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  validateAddress() â”‚                    â”‚
       â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”€â”€â–º Emsifa API    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
       â”‚                    â”‚  Auto-fill fields  â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Select Products   â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  Submit Order      â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ createOrGetUser()  â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ upsertCustomer()   â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ generateOrderNum() â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ createOrder()      â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ addOrderItems()    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ sendOrderConfirm() â”‚
       â”‚                    â”‚                    â”‚ â”€â”€â–º Fonnte API     â”‚
       â”‚  Refresh Orders    â”‚                    â”‚                    â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
```

### 3. Order Status Progression

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ORDER STATUS STATE MACHINE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     START       â”‚
                              â”‚  (Order Created)â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        WAITING_CONFIRMATION         â”‚
                    â”‚    (Admin sees in Column 1)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚                 â”‚
                    â–¼                 â”‚                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     CANCELLED       â”‚          â”‚     â”‚     PROCESSING      â”‚
     â”‚  (Admin cancels)    â”‚          â”‚     â”‚  (Admin confirms)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                â”‚
                                      â”‚                â–¼
                                      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚     â”‚      SHIPPED        â”‚
                                      â”‚     â”‚  (Admin inputs resi)â”‚
                                      â”‚     â”‚                     â”‚
                                      â”‚     â”‚  Actions:           â”‚
                                      â”‚     â”‚  - Set resi number  â”‚
                                      â”‚     â”‚  - Set shipping_costâ”‚
                                      â”‚     â”‚  - Set courier      â”‚
                                      â”‚     â”‚  - Send WA notif    â”‚
                                      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                â”‚
                                      â”‚                â–¼
                                      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚     â”‚     COMPLETED       â”‚
                                      â”‚     â”‚  (Order delivered)  â”‚
                                      â”‚     â”‚                     â”‚
                                      â”‚     â”‚  Actions:           â”‚
                                      â”‚     â”‚  - Set completed_at â”‚
                                      â”‚     â”‚  - If has affiliatorâ”‚
                                      â”‚     â”‚    â†’ Add commission â”‚
                                      â”‚     â”‚      to balance     â”‚
                                      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚      END        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Commission & Binding Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    90-DAY BINDING & COMMISSION SYSTEM                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Day 0: Customer clicks Affiliator's link
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check: Has active binding?           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NO  â†’ Create new binding              â”‚
â”‚        (start_date = now)              â”‚
â”‚        (end_date = now + 90 days)      â”‚
â”‚                                        â”‚
â”‚  YES (same affiliator) â†’ Keep binding  â”‚
â”‚                                        â”‚
â”‚  YES (different affiliator)            â”‚
â”‚        â†’ Keep old binding until expire â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer places order                 â”‚
â”‚  Order.affiliator_id = bound affiliatorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Order becomes COMPLETED               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Calculate commission:                 â”‚
â”‚  commission = total_produk *           â”‚
â”‚               (commission_rate / 100)  â”‚
â”‚                                        â”‚
â”‚  Default rate: 10%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update affiliator balance:            â”‚
â”‚  current_balance += commission         â”‚
â”‚  total_commission += commission        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Day 90+: Binding expires
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer can be bound to new          â”‚
â”‚  affiliator on next order with link    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Withdrawal Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          WITHDRAWAL PROCESS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Affiliator  â”‚     â”‚ Withdrawals  â”‚     â”‚    Admin     â”‚     â”‚   Balance    â”‚
â”‚  Dashboard   â”‚     â”‚    Table     â”‚     â”‚  Dashboard   â”‚     â”‚   Update     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚ Check Balance      â”‚                    â”‚                    â”‚
       â”‚ (current_balance)  â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚ Request Withdrawal â”‚                    â”‚                    â”‚
       â”‚ (nominal, bank)    â”‚                    â”‚                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  INSERT            â”‚                    â”‚
       â”‚                    â”‚  status='pending'  â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ View Pending       â”‚
       â”‚                    â”‚                    â”‚ Withdrawals        â”‚
       â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ Approve            â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ deductBalance()    â”‚
       â”‚                    â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  UPDATE            â”‚                    â”‚
       â”‚                    â”‚  status='approved' â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚ Upload Bukti       â”‚
       â”‚                    â”‚                    â”‚ Transfer           â”‚
       â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  UPDATE            â”‚                    â”‚
       â”‚                    â”‚  status='paid'     â”‚                    â”‚
       â”‚                    â”‚  bukti_url=xxx     â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚ See History        â”‚                    â”‚                    â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
```

---

## ğŸ”— FOREIGN KEY RELATIONSHIPS

```sql
-- Orders references Users
orders.user_id â†’ users.id

-- Orders optionally references Affiliators
orders.affiliator_id â†’ affiliators.id (nullable)

-- Order Items references Orders
order_items.order_id â†’ orders.id

-- Order Items references Products
order_items.product_id â†’ products.id

-- Customer Binding references Users
customer_binding.user_id â†’ users.id

-- Customer Binding references Affiliators
customer_binding.affiliator_id â†’ affiliators.id

-- Withdrawals references Affiliators
withdrawals.affiliator_id â†’ affiliators.id

-- Affiliator Product Links references Affiliators & Products
affiliator_product_links.affiliator_id â†’ affiliators.id
affiliator_product_links.product_id â†’ products.id

-- Users optionally references Affiliators (binding shortcut)
users.binding_affiliator_id â†’ affiliators.id (nullable)
```

---

## ğŸ“± COMPONENT-TO-DATA MAPPING

| Component | Reads From | Writes To |
|-----------|------------|-----------|
| App.jsx | products | - |
| Dashboard.jsx | orders, products, affiliators, customers, withdrawals | - |
| AdminOrdersPanel.jsx | orders | orders (status update) |
| AdminProductsPanel.jsx | products | products |
| AdminAffiliatorsPanel.jsx | affiliators | affiliators |
| OfflineOrderForm.jsx | products, customers | orders, order_items, users, customers |
| ShippingModal.jsx | - | orders (resi, shipping) |
| AffiliatorDashboard.jsx | orders, bindings, withdrawals | withdrawals |
| AuthModal.jsx | admins, affiliators | affiliators (register) |
| CartDrawer.jsx | (local cart state) | orders, order_items, users |

---

## ğŸ“Š STATE MANAGEMENT MAP

```
App.jsx (Root State)
â”œâ”€â”€ user: { id, nama, email, type }
â”œâ”€â”€ products: []
â”œâ”€â”€ cart: []
â”œâ”€â”€ modalState: { isOpen, mode, product }
â”‚
â””â”€â”€ Dashboard.jsx (Dashboard State)
    â”œâ”€â”€ orders: []
    â”œâ”€â”€ customers: []
    â”œâ”€â”€ affiliators: []
    â”œâ”€â”€ withdrawals: []
    â”œâ”€â”€ bindings: []
    â”œâ”€â”€ products: []
    â”œâ”€â”€ summary: {}
    â”‚
    â”œâ”€â”€ UI States:
    â”‚   â”œâ”€â”€ activeTab
    â”‚   â”œâ”€â”€ loading
    â”‚   â”œâ”€â”€ successMsg
    â”‚   â”œâ”€â”€ errorMsg
    â”‚
    â”œâ”€â”€ Modal States:
    â”‚   â”œâ”€â”€ showOfflineOrderForm
    â”‚   â”œâ”€â”€ showShippingModal
    â”‚   â”œâ”€â”€ showEditProductModal
    â”‚   â”œâ”€â”€ selectedOrder
    â”‚   â””â”€â”€ ... etc
    â”‚
    â””â”€â”€ Form States:
        â”œâ”€â”€ offlineOrder: { customer_name, phone, address, items: [] }
        â”œâ”€â”€ withdrawalForm: { nominal, bank_name, account_number }
        â””â”€â”€ editProductForm: { name, price, ... }
```

---

**END OF DATA WIRING DIAGRAM**
